<!DOCTYPE html>
<html>
    <head>
        <script src="//treetopflyer.github.com/vcore/lib.js"></script>
    </head>
    <body>
        <script>
            
var NN = {};

NN.TrainingSet = {};
NN.TrainingSet.Instances = [];
NN.TrainingSet.Create = function()
{
    var obj = {};

    obj.Members = [];
    obj.Order = [];
    
    NN.TrainingSet.Instances.push(obj);
    return obj;
};

NN.TrainingSet.Add = function(inTrainingSet, inType, inData)
{
    inTrainingSet.Order.push(inTrainingSet.Members.length);
    inTrainingSet.Members.push({
        Input: inData,
        Output: inType
    });
};
NN.TrainingSet.Randomize = function(inTrainingSet)
{
      var newOrder = [];
      var selection;
      while(inTrainingSet.Order.length != 0)
      {
          selection = Math.floor(inTrainingSet.Order.length * Math.random());
          inTrainingSet.Order.splice(selection, 1);
          newOrder.push(selection);
      }
};



NN.Layer = {};
NN.Layer.Create = function(sizeIn, sizeOut)
{
    var i;
    var min = [];
    var max = [];
    var obj = {};
    
    sizeIn++;
    
    obj.Forward = {};
    for(i=0; i<sizeIn; i++)
    {
        min.push(-0.5);
        max.push(0.5);
    }
    obj.Forward.Matrix = M.Box([min, max], sizeOut);
    obj.Forward.StageInput = [];
    obj.Forward.StageAffine = [];
    obj.Forward.StageSigmoid = [];
    
    obj.Backward = {};
    obj.Backward.Matrix = M.Transpose(obj.Forward.Matrix);
    obj.Backward.StageInput = [];
    obj.Backward.StageSigmoid = [];
    obj.Backward.StageAffine = [];
    
    return obj;
};
NN.Layer.Forward = function(inLayer, inInput)
{
    inLayer.Forward.StageInput = M.Pad(inInput); // Pad the input
    inLayer.Forward.StageAffine = M.Transform(inLayer.Forward.Matrix, inLayer.Forward.StageInput);
    inLayer.Forward.StageSigmoid = M.Sigmoid(inLayer.Forward.StageAffine);
    
    return inLayer.Forward.StageSigmoid;
};
NN.Layer.Backward = function(inLayer, inInput)
{
    inLayer.Backward.StageInput = inInput;
    inLayer.Backward.Matrix = M.Transpose(inLayer.Forward.Matrix);
    inLayer.Backward.StageSigmoid = M.Derivative(inLayer.Forward.StageSigmoid);
    inLayer.Backward.StageAffine = M.Transform(inLayer.Backward.Matrix, inLayer.Backward.StageSigmoid);
    inLayer.Backward.StageAffine = M.Unpad(inLayer.Backward.StageAffine); // Unpad the output
    
    return inLayer.Backward.StageAffine;
};
NN.Layer.Adjust = function(inLayer, inLearningRate)
{
    var deltas;
    var vector;
    var scalar;
    var batchSize = inLayer.Forward.StageInput.length;
    var i, j;
    
    for(i=0; i<batchSize; i++)
    {
        deltas = [];
        vector = inLayer.Forward.StageInput[i];
        for(j=0; j<inLayer.Forward.Matrix.length; j++)
        {
            scalar = inLayer.Backward.StageSigmoid[i][j] * (-inLearningRate) / batchSize;
            deltas[j] = V.Scale(vector, scalar);
        }
        inLayer.Forward.Matrix = M.Add(inLayer.Forward.Matrix, deltas);
    }
};



NN.Network = {};
NN.Network.Create = function()
{
    var obj = {};
    var i;    
    
    obj.Layers = [];
    obj.LearningRate = 0.1;

    for(i=0; i<arguments.length-1; i++)
    {
        obj.Layers.push(NN.Layer.Create(arguments[i], arguments[i+1]));
    }
    
    return obj;
};
NN.Network.Observe = function(inNetwork, inBatch)
{
      var input = inBatch;
      var i;
      for(i=0; i<inNetwork.Layers.length; i++)
      {
          input = NN.Layer.Forward(inNetwork.Layers[i], input);
      }
};
NN.Network.Error = function(inNetwork, inTraining)
{
      return M.Subtract(inNetwork.Layers[inNetwork.layers.length-1].Forward.StageSigmoid, inTraining);
};
NN.Network.Learn = function(inNetwork, inError)
{
      var input = inError;
      var i;
      for(i=inNetwork.Layers.length-1; i>=0; i--)
      {
          input = NN.Layer.Backward(inNetwork.Layers[i], input);
          NN.Layer.Adjust(inNetwork.Layers[i], inNetwork.LearningRate);
      }
};

        </script>
        <script>

var n1 = NN.Network.Create(2, 10, 3);
NN.Network.Observe(n1, [[0, 1]]);
NN.Network.Learn(n1, [[1, 0, -1]]);

        </script>
    </body>
</html>